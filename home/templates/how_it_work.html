{% extends 'base.html' %}

{% block title %}Virtual Try-On - Dimension Studio{% endblock %}

{% block content %}
<style>
    :root {
        --primary-blue: #1a73e8;
        --light-gray-bg: #f8f9fa;
        --border-color: #dee2e6;
        --text-color-dark: #212529;
        --text-color-light: #6c757d;
        --cream-bg: #fdfae6;
        --white-bg: #ffffff;
        --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s ease;
    }

    .virtual-tryon-page {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: var(--light-gray-bg);
        color: var(--text-color-dark);
        line-height: 1.6;
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
    }

    .page-title {
        text-align: center;
        margin: 1.5rem 0;
        font-size: 2.2rem;
        color: var(--text-color-dark);
        font-weight: 700;
    }

    .page-subtitle {
        text-align: center;
        margin-bottom: 2rem;
        color: var(--text-color-light);
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
    }

    .steps-container {
        display: flex;
        flex-wrap: wrap;
        gap: 30px;
        justify-content: center;
        margin-bottom: 30px;
    }

    .step-column {
        background-color: var(--white-bg);
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        padding: 25px;
        flex: 1;
        min-width: 320px;
        max-width: 420px;
        transition: var(--transition);
        display: flex;
        flex-direction: column;
    }

    .step-column:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .step-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border-color);
    }

    .step-number {
        background-color: var(--primary-blue);
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.1rem;
    }

    .step-title {
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--text-color-dark);
    }

    .info-icon {
        color: var(--text-color-light);
        cursor: help;
        margin-left: auto;
        font-size: 1.1rem;
    }

    .upload-box {
        border: 2px dashed var(--border-color);
        border-radius: 8px;
        height: 250px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: var(--text-color-light);
        font-size: 0.95em;
        text-align: center;
        transition: var(--transition);
        margin-bottom: 25px;
        cursor: pointer;
        background-color: var(--white-bg);
        position: relative;
        overflow: hidden;
    }

    .upload-box:hover {
        border-color: var(--primary-blue);
        background-color: rgba(26, 115, 232, 0.03);
    }

    .upload-icon {
        font-size: 3.5rem;
        margin-bottom: 15px;
        color: var(--text-color-light);
        transition: var(--transition);
    }

    .upload-box:hover .upload-icon {
        color: var(--primary-blue);
        transform: scale(1.1);
    }

    .upload-box span {
        display: block;
        margin-bottom: 5px;
    }

    .upload-box input[type="file"] {
        display: none;
    }

    .selected-image-review {
        margin-top: 20px;
        display: none;
    }

    .selected-image-review.active {
        display: block;
    }

    .review-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 12px;
        color: var(--text-color-dark);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .review-image-container {
        border-radius: 8px;
        overflow: hidden;
        height: 120px;
        border: 1px solid var(--border-color);
        background-color: var(--white-bg);
    }

    .review-image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .examples-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 25px 0 15px;
        color: var(--text-color-dark);
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .examples-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .example-image-wrapper {
        width: 100%;
        aspect-ratio: 1/1;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid transparent;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        background-color: var(--light-gray-bg);
    }

    .example-image-wrapper img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .example-image-wrapper:hover {
        transform: translateY(-3px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .example-image-wrapper.selected {
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
    }

    .result-box {
        background-color: var(--white-bg);
        border-radius: 8px;
        height: 300px;
        display: flex;
        justify-content: center;
        align-items: center;
        color: var(--text-color-light);
        font-size: 0.95em;
        margin-bottom: 25px;
        border: 1px solid var(--border-color);
        overflow: hidden;
    }

    .result-box img {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
    }

    .result-controls {
        background-color: var(--white-bg);
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
        box-shadow: var(--card-shadow);
    }

    .control-group {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
    }

    .control-group label {
        color: var(--text-color-dark);
        font-size: 0.95em;
        min-width: 100px;
    }

    .control-group input[type="number"] {
        width: 100px;
        padding: 10px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
        background-color: var(--white-bg);
        color: var(--text-color-dark);
        text-align: center;
        -moz-appearance: textfield;
    }

    .control-group input[type="number"]::-webkit-outer-spin-button,
    .control-group input[type="number"]::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    .control-group input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--primary-blue);
    }

    .info-display {
        background-color: var(--light-gray-bg);
        color: var(--text-color-dark);
        padding: 10px 15px;
        border-radius: 6px;
        font-size: 0.95em;
        margin-top: 10px;
        font-family: monospace;
    }

    .run-button {
        background-color: var(--primary-blue);
        color: var(--white-bg);
        padding: 14px 28px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1.1rem;
        font-weight: 600;
        transition: var(--transition);
        width: 100%;
        margin-top: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    .run-button:hover {
        background-color: #1664c0;
        transform: translateY(-2px);
    }

    .run-button:active {
        transform: translateY(1px);
    }

    @media (max-width: 768px) {
        .steps-container {
            flex-direction: column;
            align-items: center;
        }
        
        .step-column {
            width: 100%;
            max-width: 500px;
        }
    }

    /* Animation for uploaded image */
    @keyframes fadeIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }

    .uploaded-image {
        animation: fadeIn 0.5s ease;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
</style>

<div class="virtual-tryon-page">
    <h1 class="page-title">Trải Nghiệm Thử Đồ Ảo</h1>
    <p class="page-subtitle">Tải lên ảnh của bạn và trang phục để xem chúng kết hợp với nhau như thế nào. Công nghệ AI của chúng tôi sẽ tạo ra hình ảnh thử đồ chân thực chỉ trong vài giây.</p>
    
    <div class="steps-container">
        <!-- Step 1 -->
        <div class="step-column">
            <div class="step-header">
                <div class="step-number">1</div>
                <h3 class="step-title">Tải ảnh người lên</h3>
                <i class="fas fa-info-circle info-icon" title="Ảnh nên có người đứng thẳng, rõ mặt và toàn thân"></i>
            </div>
            
            <div class="upload-box" id="person-image-upload-box">
                <input type="file" id="person-image-input" accept="image/*">
                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                <span>Kéo thả ảnh vào đây</span>
                <span>hoặc</span>
                <span>Nhấp để tải lên</span>
            </div>
            
            <div class="selected-image-review" id="person-review">
                <h4 class="review-title"><i class="fas fa-check-circle"></i> Ảnh đã chọn</h4>
                <div class="review-image-container">
                    <img src="" alt="Ảnh người đã chọn" id="person-review-image">
                </div>
            </div>
            
            <h4 class="examples-title"><i class="fas fa-images"></i> Ảnh ví dụ</h4>
            <div class="examples-grid" id="person-examples">
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh người ví dụ 1"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1519085360753-af0119f7cbe7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh người ví dụ 2"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh người ví dụ 3"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1513956589380-bad6acb9b9d4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh người ví dụ 4"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1489424731084-a5d8b219a5bb?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh người ví dụ 5"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1485178575877-1a13bf489dfe?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh người ví dụ 6"></div>
            </div>
        </div>
        
        <!-- Step 2 -->
        <div class="step-column">
            <div class="step-header">
                <div class="step-number">2</div>
                <h3 class="step-title">Tải ảnh trang phục lên</h3>
                <i class="fas fa-info-circle info-icon" title="Ảnh trang phục nên được chụp trên nền trắng và rõ nét"></i>
            </div>
            
            <div class="upload-box" id="garment-image-upload-box">
                <input type="file" id="garment-image-input" accept="image/*">
                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                <span>Kéo thả ảnh vào đây</span>
                <span>hoặc</span>
                <span>Nhấp để tải lên</span>
            </div>
            
            <div class="selected-image-review" id="garment-review">
                <h4 class="review-title"><i class="fas fa-check-circle"></i> Ảnh đã chọn</h4>
                <div class="review-image-container">
                    <img src="" alt="Ảnh trang phục đã chọn" id="garment-review-image">
                </div>
            </div>
            
            <h4 class="examples-title"><i class="fas fa-images"></i> Ảnh ví dụ</h4>
            <div class="examples-grid" id="garment-examples">
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1523381294911-8d3cead13475?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh trang phục ví dụ 1"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1591047139829-d91aecb6caea?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh trang phục ví dụ 2"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1618354691373-d851c5c3a990?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh trang phục ví dụ 3"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1552374196-1ab2a1c593e8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh trang phục ví dụ 4"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1551232864-3f0890e580d9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh trang phục ví dụ 5"></div>
                <div class="example-image-wrapper"><img src="https://images.unsplash.com/photo-1520006403909-838d6b92c22e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=200&q=80" alt="Ảnh trang phục ví dụ 6"></div>
            </div>
        </div>
        
        <!-- Step 3 -->
        <div class="step-column">
            <div class="step-header">
                <div class="step-number">3</div>
                <h3 class="step-title">Xem kết quả thử đồ</h3>
                <i class="fas fa-info-circle info-icon" title="Kết quả sẽ được tạo bằng công nghệ AI trong vài giây"></i>
            </div>
            
            <div class="result-box" id="result-display">
                <div class="result-placeholder">
                    <i class="fas fa-tshirt" style="font-size: 5rem; color: #e0e0e0;"></i>
                    <p style="margin-top: 20px; font-size: 1.1rem;">Kết quả thử đồ sẽ hiển thị tại đây</p>
                </div>
            </div>
            
            <div class="result-controls">
                <div class="control-group">
                    <label for="seed-input">Seed:</label>
                    <input type="number" id="seed-input" value="0" min="0">
                    <input type="checkbox" id="random-seed-checkbox" checked>
                    <label for="random-seed-checkbox">Seed ngẫu nhiên</label>
                </div>
                
                <div class="control-group">
                    <label>Seed đã dùng:</label>
                    <div id="seed-used-display" class="info-display">Chưa có dữ liệu</div>
                </div>
                
                <button class="run-button">
                    <i class="fas fa-play-circle"></i> Chạy Thử Đồ
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to handle image selection (upload or example)
        function setupImageSelection(uploadBoxId, inputId, examplesGridId, reviewContainerId, reviewImageId) {
            const uploadBox = document.getElementById(uploadBoxId);
            const fileInput = document.getElementById(inputId);
            const examplesGrid = document.getElementById(examplesGridId);
            const reviewContainer = document.getElementById(reviewContainerId);
            const reviewImage = document.getElementById(reviewImageId);
            
            // Handle click to upload
            uploadBox.addEventListener('click', () => {
                fileInput.click();
            });
            
            // Handle file input change
            fileInput.addEventListener('change', (event) => {
                if (event.target.files.length > 0) {
                    const file = event.target.files[0];
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Display the uploaded image in the upload box
                        uploadBox.innerHTML = `<img src="${e.target.result}" class="uploaded-image" alt="Uploaded Image">`;
                        
                        // Display the image in the review section
                        reviewImage.src = e.target.result;
                        reviewContainer.classList.add('active');
                        
                        // Deselect all examples when a new file is uploaded
                        examplesGrid.querySelectorAll('.example-image-wrapper').forEach(imgWrapper => {
                            imgWrapper.classList.remove('selected');
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Handle example image selection
            examplesGrid.addEventListener('click', (event) => {
                const selectedImageWrapper = event.target.closest('.example-image-wrapper');
                if (selectedImageWrapper) {
                    // Deselect previous examples
                    examplesGrid.querySelectorAll('.example-image-wrapper').forEach(imgWrapper => {
                        imgWrapper.classList.remove('selected');
                    });
                    
                    // Select current example
                    selectedImageWrapper.classList.add('selected');
                    
                    // Display the selected example image in the upload box
                    const imgSrc = selectedImageWrapper.querySelector('img').src;
                    uploadBox.innerHTML = `<img src="${imgSrc}" class="uploaded-image" alt="Selected Example">`;
                    
                    // Display the image in the review section
                    reviewImage.src = imgSrc;
                    reviewContainer.classList.add('active');
                    
                    // Clear file input if an example is selected
                    fileInput.value = '';
                }
            });
        }
        
        // Set up for person image
        setupImageSelection(
            'person-image-upload-box', 
            'person-image-input', 
            'person-examples',
            'person-review',
            'person-review-image'
        );
        
        // Set up for garment image
        setupImageSelection(
            'garment-image-upload-box', 
            'garment-image-input', 
            'garment-examples',
            'garment-review',
            'garment-review-image'
        );
        
        // Handle Random Seed checkbox
        const seedInput = document.getElementById('seed-input');
        const randomSeedCheckbox = document.getElementById('random-seed-checkbox');
        
        randomSeedCheckbox.addEventListener('change', () => {
            seedInput.disabled = randomSeedCheckbox.checked;
            if (randomSeedCheckbox.checked) {
                seedInput.value = 0;
            }
        });
        
        // Handle Run button click
        const runButton = document.querySelector('.run-button');
        const resultDisplay = document.getElementById('result-display');
        const seedUsedDisplay = document.getElementById('seed-used-display');
        
        runButton.addEventListener('click', () => {
            // Show loading state
            runButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Đang xử lý...';
            runButton.disabled = true;
            
            // Simulate processing delay
            setTimeout(() => {
                // Generate a random result image for demo
                const demoImages = [
                    'https://images.unsplash.com/photo-1489987707025-afc232f7ea0f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                    'https://images.unsplash.com/photo-1596755094514-f87e34085b2c?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80',
                    'https://images.unsplash.com/photo-1552374196-c4e7ffc6e126?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'
                ];
                
                const randomIndex = Math.floor(Math.random() * demoImages.length);
                const resultImg = document.createElement('img');
                resultImg.src = demoImages[randomIndex];
                resultImg.alt = "Kết quả thử đồ";
                resultImg.style.maxWidth = '100%';
                resultImg.style.maxHeight = '100%';
                
                resultDisplay.innerHTML = '';
                resultDisplay.appendChild(resultImg);
                
                // Update seed used display
                let currentSeed = seedInput.value;
                if (randomSeedCheckbox.checked) {
                    currentSeed = Math.floor(Math.random() * 1000000);
                    seedUsedDisplay.textContent = currentSeed;
                } else {
                    seedUsedDisplay.textContent = currentSeed;
                }
                
                // Reset button
                runButton.innerHTML = '<i class="fas fa-play-circle"></i> Chạy Thử Đồ';
                runButton.disabled = false;
            }, 2000);
        });
    });
</script>
{% endblock %}